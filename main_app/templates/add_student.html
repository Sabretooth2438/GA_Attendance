{% extends 'base.html' %}

{% block title %}
    Add Student | GA Attendance
{% endblock %}

{% block content %}

<!-- Back to Class Button -->
<div class="back-to-class" style="margin-bottom: 20px;">
    <a href="{% url 'class_detail' class.pk %}" class="btn btn-back">Back to Class</a>
</div>

<h2>Add Student to {{ class.name }}</h2>
<form method="post" class="search-form">
    {% csrf_token %}
    <input type="text" name="query" placeholder="Search students" value="{{ query }}" class="search-input">
    <button type="submit" class="btn">Search</button>
</form>

{% if messages %}
    <ul>
        {% for message in messages %}
            <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
{% endif %}

<h3>Matching Students</h3>
{% if found_students %}
    <form method="post">
        {% csrf_token %}
        <ul>
            {% for student in found_students %}
                <li>
                    {{ student.username }}
                    {% if student in class.students.all %}
                        <!-- Student is already enrolled -->
                        <button type="button" class="btn btn-disabled" disabled>Already Enrolled</button>
                    {% else %}
                        <!-- Add button for students not in the class -->
                        <button type="submit" name="username" value="{{ student.username }}" class="btn btn-join">Add</button>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    </form>
{% else %}
    {% if query %}
        <p>No matching students found.</p>
    {% else %}
        <p>Enter a query to search for students.</p>
    {% endif %}
{% endif %}

<h3>Currently Enrolled Students</h3>
{% if class.students.exists %}
    <ul>
        {% for student in class.students.all %}
            <li>{{ student.username }}</li>
        {% endfor %}
    </ul>
{% else %}
    <p>No students are currently enrolled in this class.</p>
{% endif %}
{% endblock %}
